/*2013-02-07 08:26:53*/
define("http://www.kanziran.cn/assets/js/action/common.js",["jquery","config","router"],function(t,a){function o(t){var a=Math.ceil(t.height()),o=r(document).scrollTop(),e=o-a,n=o+r(window).height(),i=t.offset().top;return i>e&&n>i}function e(){var t='<p>&copy;2013 <a href="/?about">关于看自然</a> Powered by KanZiRan</p><p>Thanks <a href="http://twitter.github.com/bootstrap/" target="_blank" title="基于HTML，CSS，JAVASCRIPT的简洁灵活的前端框架及交互组件集">Bootstrap</a><a href="http://jquery.com/" target="_blank" title="一个优秀的JavaScrīpt框架。使用户能更方便地处理HTML documents、events、实现动画效果，并且方便地为网站提供AJAX交互">jQuery</a><a href="http://www.laravel.com/" target="_blank" title="Laravel是一款人性化的PHP Web框架，推荐！。">Laravel</a><a href="http://seajs.org/" target="_blank" title="SeaJS 是一个适用于 Web 端的模块加载器">SeaJS</a><a href="http://www.plupload.com/" target="_blank" title="一款基于 Flash、HTML5 的文件上传工具，其最大的特点是，在浏览器端压缩图片后会保留照片的Exif信息">Plupload</a><a href="https://github.com/aui/artTemplate" target="_blank" title="一款性能卓越的 javascript 模板引擎">artTemplate</a></p>';return t}var r=t("jquery"),n=t("config"),i=t("router");a.checkLogin=function(t){var a=n.pages;if(200===t[0])n.logined=!0,r("#login").fadeOut(100,function(){setTimeout(function(){r("#upload").show()},200)});else{r("#login").show(),r("#upload").hide();for(var o in a)o===i.action&&2===a[o]&&(location=n.home())}},a.alert=function(t){var o=r("#dialog");o.children(".modal-body").html(t),a.dialog()},a.dialog=function(){r("#dialog").modal({backdrop:!0,keyboard:!0,show:!0})},a.init=function(){r.getJSON(n.serverLink("login"),function(t){a.checkLogin(t)}),r("#logout").on("click",function(){return r.getJSON(n.serverLink("logout"),function(t){a.checkLogin(t)}),!1}),r("footer").html(e())},a.lazyload=function(){var t;r(window).bind("scroll.lazyload resize.lazyload",function(){clearTimeout(t),t=setTimeout(function(){r("div[data-src], li[data-src], img[data-src]").each(function(){var t=r(this);o(t)&&(t.is("img")?t.attr("src",t.attr("data-src")):t.css("background-image","url("+t.attr("data-src")+")"),t.removeAttr("data-src"))})},200)})}});
define("http://www.kanziran.cn/assets/js/action/login.js",["jquery","md5","config","./common"],function(n,o){var i=n("jquery"),t=n("md5"),a=n("config"),r=n("./common");o.show=function(){},o.init=function(){i("form[name=login]").on("submit",function(){var n,o=i(this),c=o.find(":password[name=password]"),e=c.val();return c.val(t(e)),n=o.serialize(),c.val(e),i.post(o.attr("action"),n,function(n){200===n[0]?(location=a.home(),r.checkLogin(n)):alert(n[1])},"json").error(function(n,o){alert(o)}),!1})}});
define("http://www.kanziran.cn/assets/js/action/photo.js",["jquery","config","./common","artTemplate"],function(e,o){var n=e("jquery"),a=e("config"),t=e("./common"),r=e("artTemplate");o.show=function(e){e=e||1,n.getJSON(a.serverLink("photo/"+e),function(e){var o=r.render("tmpl-photoview",e);n("#photoview").html(o)}),n("#player").addClass("hide")},o.init=function(){t.lazyload()},n(document).on("mousewheel","#player-overlay,#player-prev, #player-next, #player-desc",function(){return!1}),n(document).on("click","#player-close",function(){n("#player").addClass("hide")}),n(document).on("click","img[name=photoview]",function(){var e=n(this).attr("src").replace("/270/","/970/");n("#player .photo").css("background-image","url("+e+")"),n("#player").removeClass("hide")})});
define("http://www.kanziran.cn/assets/js/action/photolist.js",["jquery","config","artTemplate"],function(t,n){var e=t("jquery"),o=t("config"),i=t("artTemplate");n.tmpl="photolist",n.show=function(){e.getJSON(o.serverLink("photolist"),function(t){var n=i.render("tmpl-photo",t);e("#photo").html(n),t.pageCount&&e("#pagination").pagination(t.topicCount,{items_per_page:12,num_display_entries:10,current_page:0,num_edge_entries:1,link_to:"javascript:void(0)",prev_text:"上一页",next_text:"下一页",ellipse_text:"...",prev_show_always:!0,next_show_always:!0,callback:function(t){location=o.link("photolist/"+t)}}).show()})},n.init=function(){}});
define("http://www.kanziran.cn/assets/js/action/upload.js",["plupload","jquery","./common","config"],function(t,e){t("plupload");var i,n=t("jquery"),o=t("./common"),s=t("config");e.show=function(){},e.init=function(){i||a.init(),l.init()};var l={init:function(){var t=this;n("form[name=upload]").on("submit",function(){var e=n(this),i={};return t.check(e)&&(i.title=n.trim(e.find(":text[name=title]").val()),i.description=n.trim(e.find("textarea[name=description]").val()),i.photoList=[],n("img[photo_id]").each(function(){i.photoList.push(n(this).attr("photo_id"))}),n.post(e.attr("action"),i,function(e){200===e[0]?t.success(e[1].topicid):t.error(e[1])},"json").error(function(){alert("出现错误，请稍候再试。")})),!1})},check:function(t){return n.trim(t.find(":text[name=title]").val())?!0:(alert("请输入标题"),t.find(":text[name=title]").focus(),!1)},success:function(t){n("#upload-submit").attr({disabled:!0,title:""}).text("提交成功！再次选择照片后，可以继续提交"),n("form[name=upload]").find("input[name=topicid]").val(t);var e=n("#upload-success");e.find("a[name=view]").attr("href","#/photo/"+t),e.show()},error:function(t){"string"==typeof t&&o.alert("<p>"+t+"</p>")},reset:function(){n("form[name=upload]")[0].reset(),n("#filelist").empty(),n("#upload-list").empty(),i.splice(0,i.files.length),n("#upload-submit").attr({disabled:!0,title:"请选择照片……"}).text("提 交"),n("#upload-success").hide()}};n("button[name=upload-reset]").on("click",function(){return l.reset(),!1});var a={init:function(){var t=this;i=new plupload.Uploader({runtimes:"html5,flash",browse_button:"pickfiles",url:s.serverLink("upload"),flash_swf_url:"assets/plupload/1.5.5/plupload.flash.swf",filters:[{title:"Image files",extensions:"jpg"}],max_file_size:"10mb",resize:{width:1600,height:1600,quality:90}}),i.bind("Init",function(){n("#filelist").html("")}),i.init(),i.bind("FilesAdded",function(e,n){t.selected(n),i.start(),e.refresh()}),i.bind("UploadProgress",function(e,i){t.progress(i)}),i.bind("FileUploaded",function(e,i,n){t.uploadedOne(i,n)}),i.bind("UploadComplete",function(e,i){t.complete(i)})},selected:function(t){n("#upload-success").hide(),n("#upload-submit").attr({disabled:!0,title:""}).text("正在上传图片，暂时不能提交"),n("#filelist").html(" 选择了 <b>"+t.length+'</b> 张图片，正在上传第 <b id="FileUploaded">0</b> 张，进度 <b id="UploadProgress">0</b>%')},progress:function(t){n("#UploadProgress").html(t.percent)},uploadedOne:function(t,e){var i=n("#FileUploaded"),o=parseInt(i.text(),10)+1;i.text(o);var s=n.parseJSON(e.response);n("#upload-list").append('<div class="span2"><img src="'+s.result+'" photo_id="'+s.id+'"/></div>')},complete:function(t){n("#filelist").html(" 已上传 <b>"+t.length+"</b> 张图片"),n("#upload-submit").attr({disabled:!1,title:""}).text(" 提 交 ")}}});
